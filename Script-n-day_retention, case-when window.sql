–ó–∞–¥–∞–Ω–∏–µ
–î–∞–≤–∞–π—Ç–µ –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ –ø–æ—Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –≤–æ–≤–ª–µ—á–µ–Ω–Ω–æ—Å—Ç—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. 
–ú—ã –∑–∞–¥–∞–ª–∏—Å—å –≤–æ–ø—Ä–æ—Å–æ–º:
–ê –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞—Ö–æ–¥–æ–≤ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –Ω–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é?

–¢–æ –µ—Å—Ç—å –Ω–∞–¥–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å % –≤–∏–∑–∏—Ç–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —á–µ–ª–æ–≤–µ–∫ –∑–∞—à–µ–ª –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É 
(–µ—Å—Ç—å –∑–∞–ø–∏—Å—å –≤ UserEntry –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –¥–µ–Ω—å), –Ω–æ –Ω–µ –ø—Ä–æ—è–≤–∏–ª –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 
(–Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ CodeRun, CodeSubmit, TestStart –∑–∞ —ç—Ç–æ—Ç –∂–µ –¥–µ–Ω—å).

–°—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω—É–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü - entries_without_activities: 
–ø–æ—Å—á–∏—Ç–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0-100, –æ–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–π –¥–æ 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ
–ü—Ä–æ–¥—É–±–ª–∏—Ä—É–µ–º –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –ø–∏—Å–∞–ª–∏ –≤ –ì–ª–∞–≤–µ. 
–û–Ω–∏ –≤–∞–º –ø—Ä–∏–≥–æ–¥—è—Ç—Å—è –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏.


–ó–∞—Ö–æ–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å–º–æ—Ç—Ä–∏–º –≤ —Ç–∞–±–ª–∏—Ü–µ UserEntry.

–ó–∞–ø–∏—Å—å –≤ UserEntry –¥–µ–ª–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é–∑–µ—Ä–∞ - –≤ –º–æ–º–µ–Ω—Ç –ø–µ—Ä–≤–æ–≥–æ –≤–∏–∑–∏—Ç–∞.
–ö–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –Ω–∞ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –¥–µ–ª–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É CodeRun.
–ö–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –Ω–∞ –ü—Ä–æ–≤–µ—Ä–∫—É, –¥–µ–ª–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É CodeSubmit.
–ö–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ —Å—Ç–∞—Ä—Ç—É–µ—Ç —Ç–µ—Å—Ç, –¥–µ–ª–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É TestStart.

select 
user_id, array_agg(entry_at::date)
from userentry u
group by user_id 



with activities as (
	    select user_id, created_at::date as dt 
		from codesubmit c
		union 
		select user_id, created_at::date as dt 
		from coderun c
		union 
		select user_id, created_at::date as dt 
		from teststart t) 
select round(sum(case when a.user_id is null then 1 else 0 end)* 100.0/count(*),2) entries_without_activities
from userentry u 
left JOIN activities a ON u.entry_at::date = a.dt AND u.user_id = a.user_id

–ó–∞–¥–∞–Ω–∏–µ
–ï—Å—Ç—å –Ω–∞–±–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –ø—Ä–æ —Å–≤–æ–π –±–∏–∑–Ω–µ—Å –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, 
–∫–∞–∫–∏–µ —É—Å–ª—É–≥–∏ –≤—ã –æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ –∏–ª–∏ –∫–∞–∫–∞—è —É –≤–∞—Å –º–æ–¥–µ–ª—å –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏. 
–ö —Ç–∞–∫–∏–º –º–µ—Ç—Ä–∏–∫–∞–º –æ—Ç–Ω–æ—Å—è—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–æ–ª–æ—Ç–∞—è —Ç—Ä–æ–π–∫–∞:

DAU
WAU
MAU

–°–µ–π—á–∞—Å –ø–µ—Ä–µ–¥ –≤–∞–º–∏ —Å—Ç–æ–∏—Ç –∑–∞–¥–∞—á–∞ - –Ω–∞–ø–∏—Å–∞—Ç—å –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ MAU 
–Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∑–∞—Ö–æ–¥–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É (UserEntry).

–û–¥–Ω–∞–∫–æ, –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤:
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –ª–∏—à—å 1 —á–∏—Å–ª–æ, –∞ –Ω–µ —Ç–∞–±–ª–∏—Ü—É.
–ï—Å–ª–∏ –≤—ã –±—É–¥–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –º–µ—Å—è—Ü–∞–º, —Ç–æ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –º–æ–∂–µ—Ç –∏—Å–ø–æ—Ä—Ç–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, —Ç.–∫. –æ–Ω –Ω–µ–ø–æ–ª–Ω—ã–π (–µ—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞).
MAU != 4*WAU
MAU != 30*DAU

–ü–æ—ç—Ç–æ–º—É –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–∞—Ö –¥–∞–≤–∞–π—Ç–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–≤–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º:
–£—á–∏—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –º–µ—Å—è—Ü—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞—Ö–æ–¥—ã –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –≤ —Ç–µ—á–µ–Ω–∏–µ 25 
–∏–ª–∏ –±–æ–ª–µ–µ –¥–Ω–µ–π (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–æ–¥—Ä—è–¥

select date_trunc('month',entry_at), count(distinct u.user_id)
from userentry u
group by date_trunc('month',entry_at)

select round(avg(active_users), 2) MAU
from ( select date_trunc('month',entry_at), 
			count(distinct date_part('day',entry_at)), 
			count(distinct u.user_id) as active_users
			from userentry u
			group by date_trunc('month',entry_at)
			having count(distinct date_part('day',entry_at)) >=25) t1

			
–í —Ä–∞–º–∫–∞—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Å —Ü–µ–ª—å—é —Å–º–µ–Ω—ã –º–æ–¥–µ–ª–∏ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ IT Resume –Ω–∞–º –æ—á–µ–Ω—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ
–ø–æ—Å—á–∏—Ç–∞—Ç—å –º–µ—Ç—Ä–∏–∫—É - –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π n-day retention. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –º–Ω–æ–≥–∏–µ –≤–æ–ø—Ä–æ—Å—ã. –ù–∞–ø—Ä–∏–º–µ—Ä:

–ù—É–∂–Ω–æ –ª–∏ –≤–≤–æ–¥–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Ü–µ–ª–æ–º –¥–æ–≤–æ–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ —É—Ö–æ–¥—è—Ç —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã?
–ö–∞–∫–æ–µ —Å–µ–π—á–∞—Å –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ—Ç–µ–Ω—à–µ–Ω –∏ –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ –Ω–∞–º –µ–≥–æ –Ω—É–∂–Ω–æ –ø–æ–≤—ã—à–∞—Ç—å, —á—Ç–æ–±—ã —Ö–æ—Ç—è
–±—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤ –ø–æ–ª—É—á–∞—Ç—å –¥–µ–Ω—å–≥–∏ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É?
–ù–∞ –∫–∞–∫–æ–π –¥–µ–Ω—å –æ—Å–Ω–æ–≤–Ω–∞—è –º–∞—Å—Å–∞ –ª—é–¥–µ–π –æ—Ç–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è?
–ù–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ N-–¥–Ω–∏ (–ø–æ —Å—É—Ç–∏, —ç—Ç–æ —Å–∞–º—ã–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—Ç—Å–µ—á–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ): 
0, 1, 3, 7, 14, 30, 60 –∏ 90 –¥–Ω—è. –£ –Ω–∞—Å –Ω–µ —Ç–∞–∫ –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö, –ø–æ—ç—Ç–æ–º—É –æ–≥—Ä–∞–Ω–∏—á–∏–º—Å—è –∫–≤–∞—Ä—Ç–∞–ª–æ–º üòÑ

–í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–æ–±—å–µ–º –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º - —Ç–∞–∫ –Ω–∞–º–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–µ–π.
–í –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–∑–Ω–∞–∫–∞ –∫–æ–≥–æ—Ä—Ç—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Å—è—Ü —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ù–∞ –≤—ã—Ö–æ–¥–µ –≤—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–¥–∞ (—ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ñ–æ—Ä–º–∞, –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ —Ç–æ—á–Ω—ã–µ):
–°—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
cohort - —Å—Ç–æ–ª–±–µ—Ü —Å –∫–æ–≥–æ—Ä—Ç–∞–º–∏ (–≥–æ–¥ - –º–µ—Å—è—Ü)
N (%) - n-day, –≥–¥–µ N - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —á–∏—Å–ª–æ
–ó–Ω–∞—á–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ –æ–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
–°—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –æ—Å—Ç–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –∫–æ–≥–æ—Ä—Ç.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ
–ü—Ä–æ–¥—É–±–ª–∏—Ä—É–µ–º –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –ø–∏—Å–∞–ª–∏ –≤ –ì–ª–∞–≤–µ. 
–û–Ω–∏ –≤–∞–º –ø—Ä–∏–≥–æ–¥—è—Ç—Å—è –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏.
–ó–∞—Ö–æ–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å–º–æ—Ç—Ä–∏–º –≤ —Ç–∞–±–ª–∏—Ü–µ UserEntry.
–ö–æ–≥–æ—Ä—Ç—ã –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ retention —Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–æ –º–µ—Å—è—Ü–∞–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 
–∏ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞—è —Å 2022 –≥–æ–¥–∞.
–î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ UserEntry –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± –∏—Ö –≤—Ö–æ–¥–µ –≤ —Å–∞–º—ã–π –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å. 
–ü–æ—ç—Ç–æ–º—É –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–µ—Ç–µ–Ω—à–µ–Ω–∞ 0 –¥–Ω—è —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ö–æ–¥–∏–ª–∏ –≤ 0 –¥–µ–Ω—å.

–ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–∞—Ö –æ–ø–∏—Ä–∞–π—Ç–µ—Å—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–Ω–∏ - 24 —á–∞—Å–∞. –ï—Å–ª–∏ —è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è —Å–µ–≥–æ–¥–Ω—è –≤ 23:59, 
—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É —É–∂–µ –ø–æ—à–µ–ª 1 –¥–µ–Ω—å. –ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –Ω–∞—á–Ω–µ—Ç—Å—è –∑–∞–≤—Ç—Ä–∞ –≤ 23:59.
–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–µ–π.

with cte as (
	select to_char(u.date_joined, 'YYYY-mm') cohort, 
			ue.user_id, 
			ue.entry_at::date dt_entry, 
			u.date_joined::date dt_birthday,
			extract(days from ue.entry_at - u.date_joined) dt_diff    
	from userentry ue 
	left join users u on u.id = ue.user_id
	where to_char(u.date_joined, 'YYYY') = '2022'  	
	)
select cohort,
		round(count(distinct case when dt_diff = 0 then user_id end)*100/count(distinct case when dt_diff = 0 then user_id end)::numeric, 2) as "0(%)",
		round(count(distinct case when dt_diff = 1 then user_id end)*100/count(distinct case when dt_diff = 0 then user_id end)::numeric , 2) as "1(%)",
		round(count(distinct case when dt_diff = 3 then user_id end)*100/count(distinct case when dt_diff = 0 then user_id end)::numeric, 2)as "3(%)",
		round(count(distinct case when dt_diff = 7 then user_id end)*100/count(distinct case when dt_diff = 0 then user_id end)::numeric , 2)as "7(%)",
		round(count(distinct case when dt_diff = 14 then user_id end)*100/count(distinct case when dt_diff = 0 then user_id end)::numeric, 2)as "14(%)",
		round(count(distinct case when dt_diff = 30 then user_id end)*100/count(distinct case when dt_diff = 0 then user_id end)::numeric, 2)as "30(%)",
		round(count(distinct case when dt_diff = 60 then user_id end)*100/count(distinct case when dt_diff = 0 then user_id end)::numeric, 2)as "60(%)",
		round(count(distinct case when dt_diff = 90 then user_id end)*100/count(distinct case when dt_diff = 0 then user_id end)::numeric, 2)as "90(%)"
from cte
group by cohort

–ö–∞–∫ –º—ã –æ–±—Å—É–¥–∏–ª–∏ –≤ –ø—Ä–æ—à–ª–æ–π –∑–∞–¥–∞—á–µ, –∫–æ–≥–¥–∞ —Å—á–∏—Ç–∞–ª–∏ N-day retention - –º–µ—Ç—Ä–∏–∫–∞ rolling retention 
–¥–ª—è –Ω–∞—Å –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª–µ–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–∞—è. –ß–µ–ª–æ–≤–µ–∫ –º–æ–≥ –∑–∞–π—Ç–∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —Å–ø—É—Å—Ç—è 20 –¥–Ω–µ–π –ø–æ—Å–ª–µ 
—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –Ω–æ –Ω–µ –ø—Ä–∏–π—Ç–∏ –≤ 7:

n-day retention 7 –¥–Ω—è –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –º—ã –ø–æ—Ç–µ—Ä—è–ª–∏ —á–µ–ª–æ–≤–µ–∫–∞
rolling retention 7 –¥–Ω—è –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ —á–µ–ª–æ–≤–µ–∫ –≤—Å–µ –µ—â–µ —Å –Ω–∞–º–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–∞ –º–µ—Ç—Ä–∏–∫–∞ 
—É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å –∏ –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –¥–Ω–∏

–ù–∞—Å —Å–Ω–æ–≤–∞ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ N-–¥–Ω–∏: 0, 1, 3, 7, 14, 30, 60 –∏ 90 –¥–Ω—è.

–í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–ø—è—Ç—å —Ä–∞–∑–±–∏–≤–∞–µ–º –ø–æ –∫–æ–≥–æ—Ä—Ç–∞–º - —Ç–∞–∫ –Ω–∞–º–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–µ–π. 
–í –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–∏–∑–Ω–∞–∫–∞ –∫–æ–≥–æ—Ä—Ç—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Å—è—Ü —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ù–∞ –≤—ã—Ö–æ–¥–µ –≤—ã –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–¥–∞ (—ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ñ–æ—Ä–º–∞, –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ —Ç–æ—á–Ω—ã–µ):

with cte as (
	select to_char(u.date_joined, 'YYYY-mm') cohort, 
			ue.user_id, 
			ue.entry_at::date dt_entry, 
			u.date_joined::date dt_birthday,
			extract(days from ue.entry_at - u.date_joined) dt_diff    
	from userentry ue 
	left join users u on u.id = ue.user_id
	where to_char(u.date_joined, 'YYYY') = '2022'  	
	)
	select cohort,
		round(count(distinct case when dt_diff >= 0 then user_id end)*100/count(distinct case when dt_diff >= 0 then user_id end)::numeric, 2) as "0(%)",
		round(count(distinct case when dt_diff >= 1 then user_id end)*100/count(distinct case when dt_diff >= 0 then user_id end)::numeric , 2) as "1(%)",
		round(count(distinct case when dt_diff >= 3 then user_id end)*100/count(distinct case when dt_diff >= 0 then user_id end)::numeric, 2)as "3(%)",
		round(count(distinct case when dt_diff >= 7 then user_id end)*100/count(distinct case when dt_diff >= 0 then user_id end)::numeric , 2)as "7(%)",
		round(count(distinct case when dt_diff >= 14 then user_id end)*100/count(distinct case when dt_diff >= 0 then user_id end)::numeric, 2)as "14(%)",
		round(count(distinct case when dt_diff >= 30 then user_id end)*100/count(distinct case when dt_diff >= 0 then user_id end)::numeric, 2)as "30(%)",
		round(count(distinct case when dt_diff >= 60 then user_id end)*100/count(distinct case when dt_diff >= 0 then user_id end)::numeric, 2)as "60(%)",
		round(count(distinct case when dt_diff >= 90 then user_id end)*100/count(distinct case when dt_diff >= 0 then user_id end)::numeric, 2)as "90(%)"
from cte
group by cohort

–£ –Ω–∞—Å –µ—Å—Ç—å –≥–∏–ø–æ—Ç–µ–∑–∞ –ø–æ –ø–æ–≤–æ–¥—É –≤–≤–µ–¥–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ IT Resume:
–ê —á—Ç–æ –µ—Å–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –∏ —Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–µ—Å–ø–ª–∞—Ç–Ω–æ?
–ì—Ä—É–±–æ –≥–æ–≤–æ—Ä—è - —Ä–µ—à–∏–ª 5 –∑–∞–¥–∞—á, –∏ –≤—Å–µ, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ.
–ß—Ç–æ–±—ã –ø—Ä–∏–Ω—è—Ç—å —Ç–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –Ω–∞–º –Ω—É–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å - –∞ —Å–∫–æ–ª—å–∫–æ –≤–æ–æ–±—â–µ –≤ —Å—Ä–µ–¥–Ω–µ–º –∑–∞–¥–∞—á –∏ —Ç–µ—Å—Ç–æ–≤ 
—Ä–µ—à–∞—é—Ç/–ø—Ä–æ—Ö–æ–¥—è—Ç –Ω–∞—à–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏.
–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤–∞—à–∞ –∑–∞–¥–∞—á–∞ –ø–æ—Å—á–∏—Ç–∞—Ç—å:
—Å–∫–æ–ª—å–∫–æ –≤ —Å—Ä–µ–¥–Ω–µ–º –∑–∞–¥–∞—á —Ä–µ—à–∞–µ—Ç –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ø—É—Å—Ç—å –¥–∞–∂–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ —Ö–æ—Ç—è 
–±—ã –¥–µ–ª–∞–µ—Ç –ø–æ–ø—ã—Ç–∫—É)
—Å–∫–æ–ª—å–∫–æ –≤ —Å—Ä–µ–¥–Ω–µ–º —Ç–µ—Å—Ç–æ–≤ –Ω–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ø—É—Å—Ç—å –¥–∞–∂–µ –Ω–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç)
–ù–æ –≤—Å–µ –º—ã –∑–Ω–∞–µ–º –∞–Ω–µ–∫–¥–æ—Ç –ø—Ä–æ ¬´—Å—Ä–µ–¥–Ω—é—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –ø–æ –±–æ–ª—å–Ω–∏—Ü–µ¬ª –∏ ¬´—Å—Ä–µ–¥–Ω—é—é –∑–∞—Ä–ø–ª–∞—Ç—É¬ª. 
–¢–∞–∫ –∏ –∑–¥–µ—Å—å.
–í –∞–Ω–∞–ª–∏—Ç–∏–∫–µ –æ—á–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ç–∞–∫–∂–µ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å –º–µ–¥–∏–∞–Ω—É. –ï—Å–ª–∏ –º–µ–¥–∏–∞–Ω–∞ –∏ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
–ø—Ä–∏–º–µ—Ä–Ω–æ —Å–æ–≤–ø–∞–¥–∞—é—Ç - –∑–Ω–∞—á–∏—Ç –≤—Å–µ —Ö–æ—Ä–æ—à–æ, –ø–µ—Ä–µ–∫–æ—Å–æ–≤ –Ω–µ—Ç. –ê –µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç —Å–∏–ª—å–Ω—ã–µ –æ—Ç–ª–∏—á–∏—è, 
–∑–Ω–∞—á–∏—Ç –∫–∞–∫–∏–µ-—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏–ª—å–Ω–æ –º–Ω–æ–≥–æ/–º–∞–ª–æ —Ä–µ—à–∞—é—Ç –∑–∞–¥–∞—á –∏ —Å–±–∏–≤–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É 
(—Å–∏–ª—å–Ω–æ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è –æ—Ç –±–æ–ª—å—à–µ–π –º–∞—Å—Å—ã –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π), –∞ –º–µ–¥–∏–∞–Ω–∞ —ç—Ç–æ –Ω–∏–≤–µ–ª–∏—Ä—É–µ—Ç.
–ü–æ—ç—Ç–æ–º—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–∞–≤–∞—Ç–µ –ø–æ—Å—á–∏—Ç–∞–µ–º —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –º–µ–¥–∏–∞–Ω—ã:

–º–µ–¥–∏–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ—à–∞–µ–º—ã—Ö –∑–∞–¥–∞—á
–º–µ–¥–∏–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏–º—ã—Ö —Ç–µ—Å—Ç–æ–≤
–í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç: –≠—Ç–æ –≤—Å–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ—Å—á–∏—Ç–∞–Ω–æ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º.
–°—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
problems_avg - —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ —Ä–µ—à–∞–µ–º—ã—Ö –∑–∞–¥–∞—á
tests_avg - —Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –ø—Ä–æ—Ö–æ–¥–∏–º—ã—Ö —Ç–µ—Å—Ç–æ–≤
problems_median - –º–µ–¥–∏–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ —Ä–µ—à–∞–µ–º—ã—Ö –∑–∞–¥–∞—á
tests_median - –º–µ–¥–∏–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –ø—Ä–æ—Ö–æ–¥–∏–º—ã—Ö —Ç–µ—Å—Ç–æ–≤

–°—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–∫—Ä—É–≥–ª–∏—Ç–µ –¥–æ 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ
–ü—Ä–æ–¥—É–±–ª–∏—Ä—É–µ–º –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã, –æ –∫–æ—Ç–æ—Ä—ã—Ö –º—ã –ø–∏—Å–∞–ª–∏ –≤ –ì–ª–∞–≤–µ. 
–û–Ω–∏ –≤–∞–º –ø—Ä–∏–≥–æ–¥—è—Ç—Å—è –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏.

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç–µ—Å—Ç, –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ TestStart.
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É, –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ CodeSubmit.
–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –¥–∞–Ω–Ω—ã–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ CodeRun.
	
with tasks as (
	select t1.user_id, count (distinct t1.problem_id) as cnt_tasks
	from (	
		select c.user_id,c.problem_id  
		from codesubmit c
		union all
		select c.user_id, c.problem_id 
		from coderun c) t1	
	group by t1.user_id),
tests as ( 
		select user_id,count(distinct test_id) as cnt_tests
		from teststart
		group by user_id)
select round(avg(cnt_tasks),2) problems_avg,
round(avg(cnt_tests), 2) tests_avg,
percentile_cont(0.5) within group (order by cnt_tasks) problems_median,
percentile_cont(0.5) within group (order by cnt_tests) tests_median
from tasks t1
full join tests t2 on t1.user_id = t2.user_id

–ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é (CodeRun, CodeSubmit, TestStart)
–Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ —á–∞—Å–∞–º —Å—É—Ç–æ–∫ (–æ—Ç 0 –¥–æ 23).

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –£—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤ —ç—Ç–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.
–°—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω—É–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ —Å—Ç–æ–ª–±—Ü—ã:
hour - –Ω–æ–º–µ—Ä —á–∞—Å–∞ –≤ —á–∏—Å–ª–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (0, 1, 2, ...)
cnt - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é —á–∞—Å–∞.

with activities as (
	    select user_id, created_at as dt 
		from codesubmit c
		union 
		select user_id, created_at as dt 
		from coderun c
		union 
		select user_id, created_at as dt 
		from teststart t) 
select date_part('hours', dt), dt::date, count(*)
from activities
group by dt::date, date_part('hours', dt)
order by dt::date asc, date_part('hours', dt) asc

–ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é (CodeRun, CodeSubmit, TestStart) 
–Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –£—á–∏—Ç—ã–≤–∞–µ–º –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≤ —ç—Ç–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.
–°—Ç–æ–ª–±—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –Ω—É–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ —Å—Ç–æ–ª–±—Ü—ã:

day - —á–∏—Å–ª–æ–≤–æ–π –Ω–æ–º–µ—Ä –¥–Ω—è (1 - –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 2 - –≤—Ç–æ—Ä–Ω–∏–∫, ...) –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
cnt - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –¥–Ω—è –Ω–µ–¥–µ–ª–∏.

with activities as (
	    select user_id, created_at as dt 
		from codesubmit c
		union 
		select user_id, created_at as dt 
		from coderun c
		union 
		select user_id, created_at as dt 
		from teststart t) 
select to_char(dt, 'Day'), count(*)
from activities
group by to_char(dt, 'Day')
order by to_char(dt, 'Day') asc

with activities as (
	    select user_id, created_at as dt 
		from codesubmit c
		union 
		select user_id, created_at as dt 
		from coderun c
		union 
		select user_id, created_at as dt 
		from teststart t) 
select extract (isodow from dt) "day", count(*) cnt
from activities
group by extract (isodow from dt)
order by extract (isodow from dt) asc

with activities as (
    select user_id, created_at as dt
    from coderun c
    union all
    select user_id, created_at as dt
    from codesubmit c2
    union all
    select user_id, created_at as dt
    from teststart
)
select
    to_char(dt, 'ID') as day,
    count(*) as cnt
from activities
group by day